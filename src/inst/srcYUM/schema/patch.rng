<?xml version="1.0" encoding="UTF-8"?>
<grammar xmlns:yum="http://linux.duke.edu/metadata/common" ns="http://novell.com/package/metadata/suse/patch" xmlns="http://relaxng.org/ns/structure/1.0" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes">
  <include href="suse-primary.rng">
    <start>
      <ref name="element-patch"/>
    </start>
    <!-- patches use localized summary and description fields -->
    <define name="element-summary">
      <oneOrMore>
        <element name="summary">
          <ref name="localized-string"/>
        </element>
      </oneOrMore>
    </define>
    <define name="element-description">
      <oneOrMore>
        <element name="description">
          <ref name="localized-string"/>
        </element>
      </oneOrMore>
    </define>
    <!-- packages in patches have an additional rpmfiles element -->
    <define name="element-package">
      <element name="yum:package">
        <ref name="package"/>
        <ref name="element-pkgfiles"/>
      </element>
    </define>
    <!-- names in dependencies can include a "kind". Should not be used for packages. -->
    <define name="attribute-name">
      <optional>
        <attribute name="kind">
          <choice>
            <value>package</value>
            <value>patch</value>
            <value>script</value>
            <value>message</value>
            <value>product</value>
          </choice>
        </attribute>
      </optional>
      <attribute name="name"/>
    </define>
  </include>
  <define name="element-patch">
    <element name="patch">
      <ref name="patch"/>
    </element>
  </define>
  <define name="localized-string">
    <attribute name="lang"/>
    <text/>
  </define>
  <define name="patch">
    <attribute name="engine"/>
    <attribute name="patchid"/>
    <attribute name="timestamp">
      <data type="nonNegativeInteger"/>
    </attribute>
    <ref name="element-name"/>
    <ref name="element-summary"/>
    <ref name="element-description"/>
    <ref name="element-version"/>
    <ref name="dependency-block"/>
    <ref name="element-category"/>
    <optional>
      <element name="reboot_needed">
        <empty/>
      </element>
    </optional>
    <optional>
      <element name="package_manager">
        <empty/>
      </element>
    </optional>
    <optional>
      <ref name="element-update_script"/>
    </optional>
    <oneOrMore>
      <element name="atoms">
        <choice>
          <ref name="element-package"/>
          <ref name="element-script"/>
          <ref name="element-message"/>
        </choice>
      </element>
    </oneOrMore>
  </define>
  <define name="dependency-block">
    <optional>
      <!-- shortcut since all atoms have the same dependency section -->
      <ref name="element-provides"/>
    </optional>
    <optional>
      <ref name="element-conflicts"/>
    </optional>
    <optional>
      <ref name="element-obsoletes"/>
    </optional>
    <optional>
      <ref name="element-freshen"/>
    </optional>
    <optional>
      <ref name="element-requires"/>
    </optional>
  </define>
  <define name="element-category">
    <element name="category">
      <choice>
        <value>youfix</value>
        <value>security</value>
        <value>recommended</value>
        <value>bonus</value>
        <value>beta</value>
      </choice>
    </element>
  </define>
  <define name="element-update_script">
    <element name="update_script">
      <text/>
    </element>
  </define>
  <define name="element-script">
    <element name="script">
      <ref name="element-name"/>
      <ref name="element-version"/>
      <element name="do">
        <data type="string"/>
      </element>
      <optional>
        <element name="undo">
          <data type="string"/>
        </element>
      </optional>
      <ref name="dependency-block"/>
    </element>
  </define>
  <define name="element-message">
    <element name="message">
      <ref name="element-name"/>
      <ref name="element-version"/>
      <attribute name="type">
        <choice>
          <value>OK</value>
          <value>YesNo</value>
        </choice>
      </attribute>
      <element name="text">
        <data type="string"/>
      </element>
      <ref name="dependency-block"/>
    </element>
  </define>
  <define name="element-pkgfiles">
    <element name="pkgfiles">
      <zeroOrMore>
        <choice>
          <ref name="element-deltarpm"/>
          <ref name="element-patchrpm"/>
          <ref name="element-plainrpm"/>
        </choice>
      </zeroOrMore>
    </element>
  </define>
  <define name="element-plainrpm">
    <element name="plainrpm">
      <ref name="shared-rpmfile-attributes"/>
    </element>
  </define>
  <define name="element-patchrpm">
    <element name="patchrpm">
      <ref name="shared-rpmfile-attributes"/>
      <oneOrMore>
        <ref name="element-base_version"/>
      </oneOrMore>
    </element>
  </define>
  <define name="element-deltarpm">
    <element name="deltarpm">
      <ref name="shared-rpmfile-attributes"/>
      <ref name="element-delta-base_version"/>
    </element>
  </define>
  <define name="shared-rpmfile-attributes">
    <attribute name="arch">
      <ref name="arch"/>
    </attribute>
    <attribute name="filename"/>
    <attribute name="downloadsize"/>
    <optional>
      <attribute name="md5sum"/>
    </optional>
    <optional>
      <attribute name="buildtime"/>
    </optional>
  </define>
  <define name="element-base_version">
    <element name="base_version">
      <ref name="version"/>
    </element>
  </define>
  <define name="element-delta-base_version">
    <element name="base_version">
      <ref name="version"/>
      <attribute name="md5sum"/>
      <attribute name="buildtime"/>
      <attribute name="sequence_info"/>
    </element>
  </define>
</grammar>
