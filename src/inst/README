InstSrc Implementation

* What is InstSrc

InstSrc is the installation source, i.e. any provider of
installation data (selections, packages, patches).

* How to get the data

This data resides on a media. InstSrc uses MediaAccess
(see media/ directory) for access to the media.

* Caching data

In order to minimize real media access (which might be costly,
e.g. for ftp access), InstSrc abstracts away from the physical media
and tries to cache meta-information about the media contents.

This allows the packagemanager to handle media contents without
actually accessing the media for most of the usual tasks. It's up
to the InstSrc to decide which information to cache and which
information to retrieve from the media.

* Handling multiple medias

In order to handle multiple installation sources in parallel, the
installation source manager (InstSrcMgr) keeps track of 'known'
sources and their cached meta-information.

* InstSrc meta-information

- url		string, specifies access data for MediaAccess
- enabled	bool, a source might be temporarely disabled but still known
		to the manager
- priority	int, used to prefer sources, i.e. patch-server before cd
		this is used to determine which package to choose
- cost		int, cost of access
		this is used to determine where to get the package
- checksig	bool, if signatures are to be checked (GPG key known)
- mirror	string, filename of real url (for mirrors)
- label		string, user defined label
- MediaInfo	see MediaInfo (product, version, vendor, architectures, ...)


----------------------------------------------------------------------------

Implementation


Since we have different kind of installation media (cd, dvd, nfs, ftp, ...)
with different kind of contents (packages, patches, ...), an abstraction
class is required which gives an uniform access to the contents.

InstSrc
-------

"InstSrc" implements this and keeps the following information

- access to media
  (cd, dvd, nfs, ...)
	(-> MediaAccess)
- description of installation source
  (product, version, vendor, ...)
	(-> InstSrcDescr)
- media contents
  (package list, selection list, patches list, ...)
	(-> InstSrcData)

The type of installation source (kind of content, i.e. installation Cd,
ftp update tree, directory with RPMs) is handled internally by InstSrcDescrPtr
and InstSrcDataPtr.

All the InstSrc gives to the outside is:

- description handler
  for use by the installation source mananger
	(-> getDescription())
- number of selections on media
	(-> numSelections())
- number of packages on media
	(-> numPackages())
- number of patches on media
	(-> numPatches())

- list of selections on media
	(-> getSelections())
- list of packages on media
	(-> getPackages())
- list of patches on media
	(-> getPatches())



InstSrcDescr
------------

This class handles description data of an installation source. This is mostly
user-readable data (for installation source management) and some media
identification data (for media recognititon).
Information about the actual content is not handled here, see
InstSrcData for this kind of stuff

Initializing InstSrcDescr

There are two ways to get media description data
1. Reading directly from a new/unknown media
2. Reading from a cache on the local fs

Both are handled by the InstSrcDescr constructor. The first by passing
a MediaAccess object, the second by passing a Pathname of the local
cache file.

A new media is automatically probed for different kind of media
description formats. If a media just has a bunch of .rpm files in
a directory, most media data will be empty. It's up to the
application using InstSrcDescr how to handle this in regard
to the user.

After reading description data for a new media, this data should
be presented to the user who must decide if this data is to
be cached (permanent InstSrc) or not (temporary InstSrc).
For a permanent InstSrc, the cache file must be generated by
calling writeCache. This writes the cache file and returns
the Pathname of the cache. If an error occurs, the Pathname
will be empty.

For the installation source manager, this cache file implementation
means just to shuffle cache file Pathnames.


InstSrcData
-----------

Media contents are handled by the InsrSrcData class.
Initialization and cache file handling is identical to InstSrcDescr
with the exception of writing a cache file. In order to keep
media description and content cache files consistent, the writeCache
function for InstSrcData must be passed the Pathname from
InstSrcDescr::writeCache.

