<HTML>
<HEAD>
<TITLE>
UnitedLinux package description
</TITLE>
</HEAD>
<BODY>
<H1>UnitedLinux package description</H1>
<H1>Motivation</H1>
An installation media provides a set of (rpm based) packages.
In order to quickly have all information required by yast for package
dependency resolving, a cache file should be present.<br>
<br>
This document describes which kind of information this cache
file should contain and it's syntax.
<br>
<p></p>
<H1>Requirements</H1>
<h2>Content requirements</h2>
<OL>
<LI><b>Name</b><br>
The package name (implicitly provided, e.g. "foo")</LI>
<LI><b>Version</b><br>
The package version (e.g. "1.42")</LI>
<LI><b>Release</b><br>
The package release (e.g. "13")</LI>
<LI><b>Architecture</b><br>
The package archictecture (e.g. "i586")</LI>
<LI><b>Requires</b><br>
list of tags required by this package</LI>
<LI><b>PreRequires</b><br>
list of tags required by the pre-inst part of this package</LI>
<LI><b>Provides</b><br>
list of tags provided by this package</LI>
<LI><b>Conflicts</b><br>
list of tags which conflict with this package</LI>
<LI><b>Obsoletes</b><br>
list of tags which are obsoleted by this package</LI>
<LI><b>Recommends</b> (opt.)<br>
list of optional tags which should be installed if possible (weak dependency)</LI>
<LI><b>Suggests</b> (opt.)<br>
list of optional tags which should be offered for installation</LI>
<LI><b>Media</b> number<br>
location of the package file if splitted media</LI>
<LI><b>Filename</b><br>
name of the package file (which might be different from name-version-release.arch.rpm !)</LI>
<LI><b>Path</b> (opt.)<br>
path on media, defaults to <i>&lt;DATADIR&gt;/&lt;arch&gt;/&lt;filename&lt;</i></LI>
<LI><b>Package Size</b><br>
Size of package file</LI>
<LI><b>Installed Size</b><br>
Size of unpacked package based on 'du.dir' sizes.</LI>
<LI><b>BuildTime</b><br>
Time of build, used for determining updates (even if Version is lower)</LI>
<LI><b>Source</b> (opt.)<br>
source package used to build a binary package.<br>
Must specify name, version, release, (src,nosrc).<br>
To be omitted if the package itself is a source package.</LI>
<LI><b>Group</b><br>
group tag as defined in package database</LI>
<LI><b>License</b><br>
as defined in package database (shortcut !)</LI>
<LI><b>Authors</b><br>
list of authors</LI>
<LI><b>ShareWith</b><br>
specifies name,version,release,architecture of a package to share the cache file
entry. All tags not provided by the current entry are taken from the 'ShareWith'
package. Useful to 'link' multiple binary packages to a single translation
file or a single 'base architecture' package with identical dependencies.</LI>
<LI><b>Keywords</b><br>
List of keywords matching this package. Useful for package query interface
in yast.</li>
</OL>
<br>
<h2>Other requirements</h2>
<UL>
<LI>Overall size of the cache file<br>
The file size should be kept small since it must be transferred
from an installation source (e.g. via ftp, http, ...) before packages
can be accessed.</LI>
<LI>Easy creation<br>
The file should be easily creatable based on 'raw' packages.</LI>
<LI>Easy parsing<br>
The file should be easily and quickly parseable.</LI>
<LI>Easy checking<br>
It must be easy to determine if a file is syntactically correct.</LI>
<LI>User readable<br>
The file contents should be readable with 'less'</LI>
<LI>Architecture independant<br>
If binary data is used, big-endian/little-endian issues must be taken into account.</LI>
</UL>
<p></p>
<H1>Implementation</H1>
The tags for
<UL>
<LI>Name</LI>
<LI>Version</LI>
<LI>Release</LI>
<LI>Architecture</LI>
</UL>
define a <b>Package</b> and should be present in a single tag.
<br>
<br>
The tags for
<UL>
<LI>MediaNr</LI>
<LI>Filename</LI>
<LI>Path</LI>
</UL>
define a <b>Location</b> and should be present in a single tag.
<br>
<br>
The values <i>src</i> and <i>nosrc</i> for <b>Architecture</b> define
a source package.<br>

<H1>Syntax</H1>
For the syntactical representation of the data, several implementation
were considered. E.g.
<UL>
<LI>XML</LI>
<LI>RDF (see <A HREF="http://www.w3.org/RDF">here</A> for details)</LI>
<LI>Binary format (i.e. dbm)</LI>
<LI>'Keyword Value' pairs (like old <tt>common.pkd</tt>)</LI>
</UL>
<br>
XML is a nice format because it gives structure and tools for reading
and manipulation are widely available. However, for package data
representation, RDF is preferred.<br>
<br>
RDF is the proposed format by various source (i.e. <A HREF="http://rpmfind.net/linux/rpm2html/">rpm2html</A>
and <A HREF="http://reno.cis.upenn.edu/~rahul/standards/packrdf/packformat.html">LSB packagedata format</A>).
For the full format, the increase in overall size is enormous and not really suitable for a compact
cache on a distribution CD. The current RDF package databases (meant for
online access via the internet) contain a single file per package.
For SuSE aaa_base the RDF description is 56kbytes and contains the full file
list and changelog.<BR>
Since this document defines primarily the CD package cache for SuSE 8.1 and
we're open to support other formats in the future, we should wait with RDF
until a common format is defined by LSB.<BR>
Another promising project besides the LSB efforts is
<A HREF="http://gnupdate.org/">gnupdate</A>, which will eventually supported
in the future.<br>
<br>
Binary data might be compact, but has endian problems and isn't readable with 'less'.<BR>
<br>
So a simple <i>keyword</i>, <i>value</i> representation is currently the best
solution considering the above mentioned requirements. Esp. since it's an
already known format from former SuSE distributions and parsers are available.<br>
<br>
Further syntax thoughts:
<ul>
<li>To save space, the keywords are shortened to a readable minimum.</li>
<li>Keywords are case sensitive and starting with an upper case letter.</li>
<li>To make parsing easier, multi-line values are actually splitted to
mutliple lines (instead of a single line with '\n' as separator).</li>
<li>For syntax checking, keywords for multi-line values are prepended with
'<tt>+</tt>'.<br>
Keywords for single line values are starting with '<tt>=</tt>'</li>
<li>Multi-line values are enclosed in start and end keywords. The end keyword
is the start keyword with a '<tt>-</tt>' prepended</li>
<li>A package description starts with the keyword <b>Pkg</b> and ends
at the next keyword <b>Pkg</b> or at end-of-file.<br>
All keyword,value pairs inbetween belong to the package named in the first
<b>Pkg</b> keyword.</li>
<li>Keywords with empty values are omitted</li>
<li>The file starts with a header defining the syntactical version of the
data</li>
</ul>
<br>
File encoding is ASCII.<BR>
File is line based.<BR>
Lines starting with '<tt>#</tt>' are ignored.<BR>

<p></p>
<H2>Header keywords</H2>
The cache file starts with a header defining the version.<br>
<TABLE border>
<tr><th>Keyword</th><th>Value</th><th>Comment</th></tr>
<tr><td valign=top>=Ver</td><td valign=top>2.0</td><td>The old (common.pkd) format was 1.1, this one is 2.0</td></tr>
</table>
<br>
The old <tt>Encoding</tt> tag is <i>not</i> needed any more since the package
data file is ASCII and does not contain any language-specific data.
<br>

<p></p>
<H2>Package entry keywords</H2>
<TABLE border>
<tr><th>Keyword</th><th>Value</th><th>Comment</th></tr>
<tr><td valign=top>=Pkg</td><td valign=top><i>name</i> <i>version</i> <i>release</i> <i>architecture</i></td><td>These four values identify a package unambiguously and are used as a key</td></tr>
<tr><td valign=top>+Req<br>-Req</td><td valign=top><i>tags</i></td><td>required for installation</td></tr>
<tr><td valign=top>+Prq<br>-Prq</td><td valign=top><i>tags</i></td><td>tags required before installation</td></tr>
<tr><td valign=top>+Prv<br>-Prv</td><td valign=top><i>tags</i></td><td>tags provided</td></tr>
<tr><td valign=top>+Con<br>-Con</td><td valign=top><i>tags</i></td><td>tags conflicting</td></tr>
<tr><td valign=top>+Obs<br>-Obs</td><td valign=top><i>tags</i></td><td>obsoleted</td></tr>
<tr><td valign=top>+Rec<br>-Rec</td><td valign=top><i>tags</i></td><td>recommended</td></tr>
<tr><td valign=top>+Sug<br>-Sug</td><td valign=top><i>tags</i></td><td>suggested</td></tr>
<tr><td valign=top>=Loc</td><td valign=top><i>media_nr</i> <i>filename</i>[ <i>path</i>]</td><td>location of the package file<br>
  <i>path</i> is optional and defaults to  <i>&lt;DATADIR&gt;/&lt;arch&gt;/&lt;filename&gt;</i><br>
  (see media description for <i>&lt;DATADIR&gt;</i>)</td></tr>
<tr><td valign=top>=Siz</td><td valign=top><i>pkgsize</i> <i>instsize</i></td><td>size in bytes</td></tr>
<tr><td valign=top>=Tim</td><td valign=top><i>buildtime</i></td><td>build time in time_t format</td></tr>
<tr><td valign=top>=Src</td><td valign=top><i>name</i> <i>version</i> <i>release</i> <i>architecture</i></td><td>of source package<br>
<i>architecture</i> must be <tt>src</tt> or <tt>nosrc</tt><br>
If <i>architecture</i> in the <b>Pkg</b> line already is <tt>src</tt> or <tt>nosrc</tt>, the
<b>Src</b> value is discarded.</td></tr>
<tr><td valign=top>=Grp</td><td valign=top><i>rpmgroup</i></td><td></td></tr>
<tr><td valign=top>=Lic</td><td valign=top><i>license</i></td><td></td></tr>
<tr><td valign=top>+Aut<br>-Aut</td><td valign=top><i>authors</i></td><td></td></tr>
<tr><td valign=top>=Shr</td><td valign=top><i>name</i> <i>version</i> <i>release</i> <i>architecture</i></td><td>of another package.<br>
All values not explicitly set in the current package entry are shared with
the mentioned package.<br>
Useful e.g. for optimized versions of the same package (i.e. i686 and i486 versions exists).<br>
It's just to save space.<br></td></tr>
<tr><td valign=top>+Key<br>-Key</td><td valign=top><i>keywords</i></td><td>coming from package database</td></tr>
</TABLE>
<p></p>
<H2>Example</H2>
<pre>
=Pkg: 3ddiag 0.494 16 i586
+Req:
/bin/cp
/bin/ln
/bin/ls
/bin/mkdir
/bin/mv
/bin/rm
/bin/cat
aaa_base
/bin/sh
/bin/sh
ld-linux.so.2
libc.so.6
libc.so.6(GLIBC_2.0)
libhd.so.5
rpmlib(PayloadIsBzip2) <= 3.0.5-1
-Req:
+Prq:
/bin/cp
/bin/ln
/bin/ls
/bin/mkdir
/bin/mv
/bin/rm
/bin/cat
aaa_base
/bin/sh
rpmlib(PayloadIsBzip2) <= 3.0.5-1
-Prq:
+Prv:
mesa:/etc/mesa.conf
-Prv:
=Loc: 1 3ddiag-0.494-16.i586.rpm
=Siz: 27958 64932
=Tim: 1028715372
=Src: 3ddiag 0.494 16 src
=Grp: System/Base
=Lic: GPL
+Aut:
Stefan Dirsch &lt;sndirsch@suse.de&gt;
-Aut:
</pre>
</BODY>
</HTML>
