<HTML>
<HEAD>
<TITLE>
YaST multiple source installation
</TITLE>
</HEAD>
<BODY>
<H1>YaST multiple source installation</H1>
<H1>Motivation</H1>
UnitedLinux defines a core set of packages which implement
the UnitedLinux runtime environment.<br>
All tests, certifications, and applications are based on this
set of packages which should not be altered in any way. The
ideal way to guarantee unaltered data, is providing it on
CD-ROM.<br>
<br>
However, this makes including (vendor specific) extensions and bug-fixes on the
same media impossible. A separate media must be supplied for
installation.<br>
<br>
The 'multiple source' approach of YaST gives a solution as it allows
installation from several (package) sources. So a customer can
start installing from the original UnitedLinux CDs, proceed with
a product CD, and end with a patch CD containing the latest security
patches.<br>
<p></p>
<H1>Implementation</H1>
The implementation is based on the <A HREF="media-descr.html">UnitedLinux
media description</A> which defines<br>
<UL>
<LI>a media ID to identify the media<br>
(the <tt>media.1/media</tt> file)</LI>
<LI>a product content description<br>
(the <tt>content</tt> file)</LI>
<LI>product selections (set of packages)<br>
(the <tt>*.sel</tt> files)</LI>
<LI>packages (rpm based)<br>
(the <tt>packages.*</tt> files)</LI>
</UL>

All these files clearly describe (the metadata of) an installation source and it's contents
as needed for YaST when starting an installation.<br>
<blockquote>
The key to the multiple source installation is the distinction between the <b>description</b>
about the source and the <b>data</b> (rpm packages) of the source.<br>
</blockquote>
<br>
Combining several sources for YaST is fairly simple, you must
<UL>
<LI>provide the media descriptions</LI>
<LI>define an installation priority</LI>
<LI>define an installation order</LI>
</UL>
<p></p>
<H2>Installation workflow</h2>
<br>
<h3>The installer source</h3>
When starting the installation from a media (CD, DVD, NFS, ...), linuxrc
looks for a <tt>/boot/root</tt> file containing a complete (cramfs based)
root-fs for YaST.<br>
Usually, this file is on the boot CD, but other installation types are
also supported by linuxrc. The information, where the <tt>/boot/root</tt>
file came from, is passed to YaST and defines the <b>installer</b> source.
<br>
<br>
YaST now looks at this installer source for a <tt>/yast/order</tt> file.
If this file exists, YaST goes into the 'multiple installation' mode.<br>
In this mode, the source description (information about the packages) is
on the installer source and the source data (the rpm packages itself) is
on separate media.<br>
If the order file does not exist, YaST does not separate the source
description from the source data and both must reside on the same media.
(The latter is what happens if you boot the first UnitedLinux CD.)<br>
<br>
<h3>The order file</h3>
The order file defines which sources are needed for installation
and their priority for installation.<br>
A typical example for an order file is given here:<br>
<pre>
# yast/order: priority of installation sources
#
# source-       product
# description   path
/yast/sles8     /sles8-i386/CD1
/yast/ul        /unitedlinux-i386/CD1
/		/
</pre>
<br>
The order file is ASCII, line based, '#' at the beginning of a line
denote a comment line.<br>
<br>
Each non-comment line should contain two (whitespace separated) directory
specifications. If the second one is omitted, it defaults to "/".<br>
<br>
The first directory specifies the location of the description.<br>
The second directory specifies the location of the product as defined <A HREF="media-descr.html">here</A>.<br>
 For CD/DVD bases products, this is usually "/". But for network installations, or
if several product are placed on a single CD, each product needs a separate path.<br>
You can even specify a full URL (e.g. "nfs://my-nfs-server.domain.org/product/CD1") in the
second column.
<br>
During installation, you can't switch the type of media. If your installer source is
CD, every other source must be CD based. If your installer source is NFS, every other source is expected to be
on the same NFS server.<br>
<br>
In the above example of the <tt>order</tt> file, note the last line being "/". This means
the last of the three installation sources is on the same media as the installer.<br>
<br>
<br>
<h3>The instorder file</h3>
As stated above, the <tt>/yast/order</tt> file lists the sources in <b>priority order</b>.
So a package from a source listed earlier in this file overrides a package (of the same name)
from a later source. This technique is used to override the yast2-translation packages
from unitedlinux-i386 (where all help texts refer to UnitedLinux) with yast2-translation packages
from sles8-i386 (where all help texts refer to SuSE Linux).<br>
<br>
But the <tt>/yast/order</tt> also defines the installation order, which might not be wanted when
the 'base' packages are on a lower-priority source.<br>
This is where <tt>/yast/instorder</tt> comes into play. This defines the <b>installation order</b>
by repeating the entries of the first column of <tt>/yast/order</tt> in the right order.<br>
<br>
A typical example for an instorder file is given here:<br>
<pre>
# yast/instorder: order of installation sources
#
# install 'ul' before 'sles8'
#
/yast/ul
/yast/sles8
/
</pre>
<br>
<h3>Setting it all up</h3>
Combining multiple sources requires that all sources comply to the <A HREF="media-descr.html">UnitedLinux
media description</A> standard.<br>
<br>
On the installer source create a <tt>yast/order</tt> as described above and copy
the description data of all sources to separate directories. List these directories
in the order file and check for conflicting package (.rpm) or selection (.sel) names.<br>
If names conflict, the name coming 'first' in the order file wins.<br>
<br>
In the 'order' example above, the 'order' directory structure looks as follows:
<pre>
yast/
  order				# order file, this must be below yast/order
  ul/				# product 'ul', placing it below yast isn't really needed
				#   but practical.
    media.1/
      media			# media ID for first CD
    content			# content file, describing the pathes
    UnitedLinux/
      setup/
        descr/
          *.sel
          packages
          packages.DU
          packages.en
          packages.de
          ...
          packages.pt
  sles8/
    media.1/
      media
    content
    suse/
      setup/
        descr/
          *.sel
          packages
          packages.DU
          packages.en
          packages.de
          ...
          packages.pt
</pre>
<br>
(In case you wonder where the '.../setp/descr/' path comes from, look at
the DESCRDIR tag of the <tt>content</tt> file specification <A HREF="media-descr.html">here</A>.)<br>
<br>
YaST now takes this description instead of the one from the 'real' media for the installation.<br>
So when asking for a specific media, this media must match the <tt>media.1/media</tt> file from the
'order' directory.<br>
<br>
All dependencies (package or selection) are fulfilled by looking at all installation sources. If multiple
sources provide a dependency, the source listed first in the 'order' file wins.<br>
(The installation order equals the installation priority currently). 
<br>
<h3>Further possibilities</h3>
Since you can also add the installer source to the order file, you can provide additional (or patched)
packages for otherwise 'fixed' (since already pressed on CD) sources. Just provide a fixed version on
the installer source and give it a higher priority.<br>
</BODY>
</HTML>
