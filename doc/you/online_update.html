<html>
<head>
<title>YaST Online Update</title>
</head>

<body bgcolor="white">
<h1>YaST Online Update</h1>

<em>This document applies to the online update of SuSE Linux 8.1.</em>

<h2>Overview</h2>
<p>The online update has a patch structure. Each patch has a patch description
file and n RPM packages.


<h2>Description</h2>

<p>YOU uses the information about the name, version and base architecture of the installed
product to determine the paths for downloading patch descriptions and RPMs from the server
and for caching these files on the local system.</p>


<h3>Box Product OR Business Produkt?</h3>

<p>If the product has not the name "SuSE-Linux" it is considered as a business product and
slightly different paths and server URLs apply.</p>


<h3>Paths to the patch data</h3>

<p>The paths to the patch data consist of a base URL or a local base path, a product
dependend path and a path depending on the type of data (i.e. descriptions, RPMs and
script).

<h4>Download URLs</h4>

<p>The download base URLs are determined by reading a list of URLs from the URL
<tt>http://www.suse.de/cgi-bin/suseservers.cgi</tt>. The list is stored locally at
<tt>/etc/suseservers</tt>. If the variable <tt>YAST2_LOADFTPSERVER</tt> in the file
<tt>/etc/sysconfig/onlineupdate</tt> is set to <tt>no</tt>, the server isn't contacted and
the download base URLs are read from the local file <tt>/etc/suseservers</tt>.</p>

<p>The default download base URLs are <tt>ftp://ftp.suse.com/pub/suse/</tt> for the box
product and <tt>http://sdb.suse.de/download/</tt> for the business products.</p>

<h4>Local Path</h4>

Downloaded files are stored locally under the directory <tt>/var/lib/YaST2/you/</tt>.
The description files for installed patches are stored at
<tt>/var/lib/YaST2/you-installed</tt>. There is no product specifig path added to the path
to the installed patches.

<h4>Product dependent paths</h4>

<p>The path to the description files and the other patch data depends on the installed
product. The base path is <tt>&lt;basearch&gt;/update/&lt;version&gt;</tt> for the box
product, and <tt>&lt;basearch&gt;/update/&lt;productname&gt;/&lt;version&gt;</tt> for the
business products. <tt>&lt;version&gt</tt> is the version of the installed product.
<tt>&lt;productname&gt;</tt> is the name of the installed product.</p>

<p>The different components of the path like description, RPMs and scripts use different
subdirectories of this path.</p>

<h4>Paths to the patch descriptions</h4>

<p>The description files are located in the directory <tt>patches</tt>.

<p>Example: Patch description files for the 8.1. box product for i386 are loaded from
<tt>ftp://ftp.suse.com/pub/suse/i386/update/8.1/patches/</tt>.</p>


<h4>Path to RPMs</h4>

<p>The RPMs are located in a architecture specific subdirectory of the directory
<tt>rpm</tt>. The filename of the RPM is contructed from the <tt>Filename:</tt> tag of the package
description, an automatically determined architecture and the version and the release from the
<tt>Version:</tt> tag of the package description. For the architecture of the RPM to be installed
the architecture of the corresponding installed RPM is taken. If there is no installed RPM, the
base architecture is used. As a last fallback <tt>noarch</tt> is used.</p>

<p>Example: i586 RPMs for the i386 version of the 8.1. box product are stored to
<tt>/var/lib/YaST2/you/i386/update/8.1/rpm/i586/</tt>.</p>

<h4>RPM file name</h4>

<p>The file name for the RPM which is looked for on the server is constructed from entries
of the <tt>Packages</tt> section of the patch description file as
<tt>&lt;name&gt;-&lt;version&gt;.&lt;arch&gt;.rpm</tt>. <tt>&lt;name&gt</tt> is the
value of <tt>Filename:</tt> stripped by the <tt>.rpm</tt> suffix. <tt>&lt;version&gt</tt>
is the value of <tt>Version:</tt>.</p>

<p><tt>&lt;arch&gt</tt> is determined by the installed system. If there already is a
version of the RPM installed on the system, its architecture is used. If not, a list of
compatible architectures is gone through.</p>

<p>If there is a patch RPM present with the name
<tt>&lt;name&gt;-&lt;version&gt;.&lt;arch&gt;.patch.rpm</tt> and a previous version of the
package is already installed, the patch RPM is used for the update.</p>

<p>The first RPM matching the criteria which is found on the server is downloaded and
installed.</p>

<p>If the <tt>InstPath:</tt> tag has a non-empty value this value is used as URL to an
external RPM. The RPM file specified by the URL is downloaded and installed. No automatic
processing of download path or file name takes place.</p>

<h4>Path to scripts</h4>

<p>Scripts are located in the directory <tt>scripts</tt>.</p>

<p>Example Scripts belonging to patches for the i386 version of the 8.1. box product are stored to
<tt>/var/lib/YaST2/you/i386/update/8.1/scripts/</tt>.</p>


<h3>Download from the server</h3>

<p>Patch informations are downloaded from the server by reading a file with the name
<tt>directory.3</tt> from the URL constructed from the base URL by adding the product
specific path and the </tt>patches</tt> directory. The <tt>directory.3</tt> file contains a
list of filenames which have to be present in the same directory. Patches are downloaded
and installed in the order of the names in this file.</p>

<p>All files downloaded from the server are checked for valid signatures.</p>


<h3>Filename of the patch description files</h3>

<p>Patch description files can have an arbitrary name.</p>


<h3>Format of the patch description file</h3>

<pre>
Kind: [security|recommended|optional|document|YaST2]

Patchname: &lt;name&gt;
Patchversion: &lt;version&lt;

Shortdescription.&lt;language&gt; : &lt;short description; one line&gt;

Longdescription.&lt;language&gt;:
&lt;long description of the patch; could have more lines&gt;
&lt;language&gt;.noitpircsedgnol:

Preinformation.&lt;language&gt;:
&lt;Information in a popup which will be displayed before the &gt;
&lt;packages of this patch will be installed. The user        &gt;
&lt;can abort the installation of THIS patch.                 &gt;
&lt;language&gt;.noitamrofnierp:

Postinformation.&lt;language&gt;:
&lt;Information in a popup which will be displayed after the &gt;
&lt;packages of this patch have been installed.              &gt;
&lt;language&gt;.noitamrofnitsop:

Size: &lt;Size of this patch in KByte&gt;

# buildtime Tue Nov 14 12:46:42 UTC 2000
Buildtime:     &lt; time in seconds&gt;

MinYaST2Version:&lt;minimal YaST2 version which is needed for installation&gt;

UpdateOnlyInstalled: &lt;true/false; Only packages ( described in this patch ) will be updated which are installed. &gt;

<!--
Installtrigger:
&lt;Script which will be execute in order to decide if the patch have to be installed.&gt;
&lt;return 0 --> patch will be installed. &gt;
Reggirtllatsni:
-->

Prescript: &lt;name of script executed before installing the patch&gt;
Postscript: &lt;name of script executed after installing the patch&gt;

Packages:
&lt;one or more package descriptions&gt;
.
..
...
like:
##
## -----&gt; bash &lt;-----
##
Filename:      bash.rpm
Label:         The GNU Bourne-Again Shell
Size:          2116014 838521
Buildtime:     973570238
BuiltFrom:     zq1/bash-version-release.[no]src.rpm
RpmGroup:      System Environment/Shells
Copyright:     1989 Free Software Foundation, Inc.
AuthorName:    Chet Ramey &lt;chet@po.cwru.edu&gt;
AuthorEmail:   
AuthorAddress: 
Version:       2.04-81
Requires:      /bin/sh   ld-linux.so.2   libc.so.6   libc.so.6(GLIBC_2.0)   libc.so.6(GLIBC_2.1)   libdl.so.2   libdl.so.2(GLIBC_2.0)   libdl.so.2(GLIBC_2.1)   libhistory.so.4   libncurses.so.5   libreadline.so.4   
Provides:      sh   bash   rbash   libhistory.so.4   libreadline.so.4   
Conflicts      ..
Oboletes:      ..
...
..
.
Segakcap:
</pre>

<table border="1" cellpadding="2">
<caption>Patch description tags</caption>
<tr><th>Tag</th><th>Possible values</th><th>Description</th></tr>
<tr>
  <td>Kind</td>
  <td>one of the strings "security", "recommended", "optional",
      "document" or "YaST2"</td>
  <td>Type of patch. See the <a href="#preselection">section about selection of patches</a>
      for details.</td>
</tr>
<tr>
  <td>Patchname</td>
  <td>string</td>
  <td>Name of the patch. All patches having the same name are handled as different versions
      of the same patch.</td>
</tr>
<tr>
  <td>Patchversion</td>
  <td>string of the form <tt>&lt;version&gt;-&lt;release&gt;</tt></td>
  <td>Version of the patch.</td>
</tr>
<tr>
  <td>Shortdescription</td>
  <td>string</td>
  <td>One-line summary of the patch</td>
</tr>
<tr>
  <td>Longdescription</td>
  <td>string</td>
  <td>Multi-line description of the patch</td>
</tr>
<tr>
  <td>Preinformation</td>
  <td>string</td>
  <td>Multi-line message, which is shown before installing the patch</td>
</tr>
<tr>
  <td>Postinformation</td>
  <td>string</td>
  <td>Multi-line message, which is shown after installing the patch</td>
</tr>
<tr>
  <td>Size</td>
  <td>Integer</td>
  <td>Size of patch in KByte</td>
</tr>
<tr>
  <td>UpdateOnlyInstalled</td>
  <td>"true" or "false"</td>
  <td>If set to "true", only packages are installed which already are installed in a previous
      version</td>
</tr>
<tr>
  <td>Prescript</td>
  <td>file name</td>
  <td>Name of script to be executed before installing the RPMs of the patch.</td>
</tr>
<tr>
  <td>Postscript</td>
  <td>file name</td>
  <td>Name of script to be executed after installing the RPMs of the patch.</td>
</tr>
<tr>
  <td>Packages</td>
  <td>list of tagged values</td>
  <td>Set of package informations, see <a href="#packageformat">package tag description</a> for
      details.</td>
</tr>
</table>

<a name="packageformat">
<table border="1" cellpadding="2">
<caption>Package description tags</caption>
<tr><th>Tag</th><th>Possible values</th><th>Description</th></tr>
<tr>
  <td>Filename</td>
  <td>String of the form <tt>&lt;RPM name&gt;.rpm</tt></td>
  <td>Name of the RPM. The <tt>.rpm</tt> suffix has to be present, but isn't used anywhere.</td>
</tr>
<tr>
  <td>Version</td>
  <td>string of the form <tt>&lt;version&gt;-&lt;release&gt;</tt></td>
  <td>Version of the RPM</td>
<tr>
  <td>Requires</td>
  <td>string</td>
  <td>List of "Requires" from RPM separated by spaces</td>
</tr>
<tr>
  <td>Provides</td>
  <td>string</td>
  <td>List of "Provides" from RPM separated by spaces</td>
</tr>
<tr>
  <td>Obsoletes</td>
  <td>string</td>
  <td>List of "Obsoletes"from RPM separated by spaces</td>
</tr>
<tr>
  <td>Label</td>
  <td>string</td>
  <td>One line description of the RPM</td>
</tr>
<tr>
  <td>Size</td>
  <td>integer</td>
  <td>Size of RPM in Bytes</td>
</tr>
<tr>
  <td>Buildtime</td>
  <td>integer</td>
  <td>Build time as extracted from RPM</td>
</tr>
<tr>
  <td>RpmGroup</td>
  <td>string</td>
  <td>RPM group as extracted from RPM</td>
</tr>
</table>
</a>



<h3>Patch names and versions</h3>

<p>If the <tt>Patchname:</tt> tag is present its value will be used as name for the patch. If
it is empty or missig the file name of the patch description file is used as name. If the
<tt>Patchversion:</tt> tag is present, its value will be used as version of the patch. If it
is empty or missing the version will be set to "0".</p>

<p>If there is more than one patch with the same name, only the patch with the highest
version will be offered for installation.</p>

<h3><a name="preselection">Which patch will be preselected for installation?</a></h3>

<p>There are some criterions for preselecting patches which will be installed
by YOU:
<ul>
  <li>If there is a patch of kind "YaST2" the newest patch of this kind is selected. All other
  patches are deselected by default.</li>
<!--  <li>The scripted defined in the patchdescription ( flag "Installtrigger" ) 
  returns true.</li>-->
  <li>If one or more packages of the patch are installed and have older versions, the patch will
  be selected.</li>
  <li>If one or more packages of the patch are older as the installed package, the patch will not
  be selected, even if other packages of the patch are newer than the installed one.</li>
<!--  <li>One or more packages have a flag ( "Category" ) which is a installed package.</li>-->
</ul>

<p>If the flag "UpdateOnlyInstalled" is not defined or is false, ALL packages of the
patch will be installed.
If this flag is "true", only packages will be updated which are already installed.
</p>

<h3>Executing scripts within a patch</h3>
<p>There is the possibility to run scripts while installing packages. The script from the
<tt>Prescript:</tt> tag is executed before the packages are installed. The script from the
<tt>Postscript:</tt> tag is executed after the packages have been installed. The scripts are
downloaded from the <tt>scripts</tt> subdirectory and stored localy before execution.</p>


<h2>Usage</h2>

<h3>GUI version</h3>

<p>The online update can be started from the YaST2 control center by selecting the corresponding
icon.</p>

<p>The GUI version of the online update can also be started by command line: <tt>yast2
online_update [.url &lt;url&gt;] [.nosigcheck]</tt>. With the <tt>.url</tt> argument the given
URL is selected as source for the patches. If the argument <tt>.nosigcheck</tt> is present the
signatures of the downloaded files aren't checked.</p>


<h3>Command line version without GUI</h3>

<pre>
Usage: online-update [-u url] [-p product] [-v version] [-a arch] [-d] [-s] [-n] [-g]
  [-i] [security] [recommended] [document] [optional]

-u url      Base URL of directory tree used to get patches from.

-g          Only download patches, don't install.
-i          Install downloaded patches, don't download.

-p product  Name of product to get patches for.
-v version  Version of product to get patches for.
-a arch     Base architecture of product to get patches for.

-d          Dry run. Only get patches, don't install them.
-n          No signature check of downloaded files.

-s          Show list of patches.
-V          Be verbose.
-D          Debug output.

security | recommended | document | optional   Types of patches to be installed.
</pre>


<h1>Patch CD Update</h1>

<p>There is also the possibilty to provide the patches on a CD ROM. 
Insert the CD ROM with the patches and start the "Patch CD update" 
in YaST2 Control Center. This is euivalent to start the online update with the URL
<tt>cd:///</tt>. You can start the Patch CD Update from the command line with <tt>yast2
online_update .cd_default</tt>.</p>

<p>The patch structure and the directories where the patches are located are exactly
the same as on the ftp server.
The path on CD ROM starts with the {ARCHITECTURE} directory,
e.g. the path on ftp server is:
<tt>/pub/suse/{ARCHITECTURE}/update/{SuSE-Version}/patches/*</tt>,
the directory structure on the CD ROM is:
<tt>{ARCHITECTURE}/update/{SuSE-Version}/patches/*</tt>.</p>

<hr>
<address><a href="mailto:cschum@suse.de">Cornelius Schumacher</a></address>
</body>
</html>
