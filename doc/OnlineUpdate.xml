<!-- Maintainer: cschum@suse.de -->

<chapter><title>Online Update Requirements</title>

<section><title>Patch sources</title>
<para>
<itemizedlist>
  <listitem><para>Sources:
    <itemizedlist>
      <listitem><para>FTP or HTTP server
	<itemizedlist>
	  <listitem><para>Authentification for business products.</para></listitem>
	  <listitem><para>Proxy support.</para></listitem>
	</itemizedlist>
      </para></listitem>
      <listitem><para>CD, local or network filesystem.</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Specific for product, platform, version.</para></listitem>
  <listitem><para>Provide list of servers which can be used as source on "master" server.</para></listitem>
  <listitem><para>Remember source settings (server names, filesystem paths etc.)</para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Patch descriptions</title>
<para>
<itemizedlist>
  <listitem><para>Patch content:
    <itemizedlist>
      <listitem><para>Meta information (description, attributes, size etc.)</para></listitem>
      <listitem><para>Dependencies</para></listitem>
      <listitem><para>References to patch elements:
	<itemizedlist>
	  <listitem><para>Scripts (could also be inlined in patch description)</para></listitem>
	  <listitem><para>RPMS
	    <itemizedlist>
	      <listitem><para>Meta information</para></listitem>
	      <listitem><para>Attributes: required, optional</para></listitem>
	      <listitem><para>Reference (URL) to RPM</para></listitem>
	    </itemizedlist>
	  </para></listitem>
	  <listitem><para>Images (files not handled by RPM, e.g. driver disks)</para></listitem>
	</itemizedlist>
      </para></listitem>
      <listitem><para>Signatures of descriptions have to be checked.</para></listitem>
    </itemizedlist>
  </para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Patch dependencies</title>
<para>
<itemizedlist>
  <listitem><para>Dependencies of packages in patch have to be resolved.</para></listitem>
  <listitem><para>Patch as a whole can have dependencies
    <itemizedlist>
      <listitem><para>Requires: Patches which have to be present before patch can be installed</para></listitem>
      <listitem><para>Obsoletes (better Supercedes? or introduce a version number?): patch which
        supercedes other patch. Superceded patch isn't offered for installation.</para></listitem>
      <listitem><para>Conflicts: Patches which have to be deinstalled before patch can be installed.</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Patch can require a minimum yast version.</para></listitem>
  <listitem><para>Dependencies determine sequence of patch installation.</para></listitem>
  <listitem><para>Dependencies can require to install packages from other sources before patch can be installed.</para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Patch selection</title>
<para>
<itemizedlist>
  <listitem><para>Display
    <itemizedlist>
      <listitem><para>Show installed patches.</para></listitem>
      <listitem><para>Show new patches.</para></listitem>
      <listitem><para>Information presented to the user:
	<itemizedlist>
	  <listitem><para>Translated short description</para></listitem>
	  <listitem><para>Translated long description</para></listitem>
	  <listitem><para>Attributes: security, required, recommended, optional, document, yast</para></listitem>
	  <listitem><para>Size of patch (calculated dynamically )</para></listitem>
	  <listitem><para>Per package
	    <itemizedlist>
	      <listitem><para>Name, Description</para></listitem>
	      <listitem><para>Size of RPM/patch RPM</para></listitem>
	    </itemizedlist>
	  </para></listitem>
	</itemizedlist>
      </para></listitem>
      <listitem><para>Sort shown patches by attribute.</para></listitem>
      <listitem><para>Option to print decriptions (maybe from support server).</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Selection
    <itemizedlist>
      <listitem><para>Automatic selection (all security, required and recommended)</para></listitem>
      <listitem><para>User defined selection (e.g. only security)</para></listitem>
      <listitem><para>Interactive selection:
	<itemizedlist>
	  <listitem><para>Default selection of patches:
	    <itemizedlist>
	      <listitem><para>Required patches are selected</para></listitem>
	      <listitem><para>Security patches are selected if at least one package is already installed</para></listitem>
	      <listitem><para>Recommended patches are selected if at least one packages is already installed</para></listitem>
	      <listitem><para>If patch description specifies InstallTriggerPackages or InstallTriggerScript and condition is met select patch.</para></listitem>
	      <listitem><para>Optional patches are not selected.</para></listitem>
	    </itemizedlist>
	  </para></listitem>
	</itemizedlist>
      </para></listitem>
      <listitem><para>Remember selection state of patches.</para></listitem>
      <listitem><para>Select individual packages from patches
	<itemizedlist>
	  <listitem><para>default selection:
	    <itemizedlist>
	      <listitem><para>all required packages.</para></listitem>
	      <listitem><para>optional packages which are already installed.</para></listitem>
	    </itemizedlist>
	  </para></listitem>
	  <listitem><para>Required packages have to be installed, if patch is installed.</para></listitem>
	  <listitem><para>Optional packages are installed if selected by user.</para></listitem>
	</itemizedlist>
      </para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>If there are required yast patches, they have to be installed and yast has to be restarted before any other patch can be installed.</para></listitem>
  <listitem><para>Option to reinstall patches.</para></listitem>
  <listitem><para>Make sure that size of patches to be installed does not exceed available disk space.</para></listitem>
  <listitem><para>Make sure that older patches do not override newer patches.</para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Patch installation</title>
<para>
<itemizedlist>
  <listitem><para>Download patch elements
    <itemizedlist>
      <listitem><para>Download patch RPMs, if available for the installed version of the package.</para></listitem>
      <listitem><para>Signatures have to be checked.</para></listitem>
      <listitem><para>Make sure that there is enough disk space for download or issue error message.</para></listitem>
      <listitem><para>If download fails due to problems on the server side try a different server.</para></listitem>
      <listitem><para>If download fails after downloading a part of the elements, allow to resume download later without starting all over.</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Process patch elements in order determined by patch description
    <itemizedlist>
      <listitem><para>Show pre/post information (special case of script)</para></listitem>
      <listitem><para>Execute pre/postinstall script</para></listitem>
      <listitem><para>Install packages
	<itemizedlist>
	  <listitem><para>Skip non-installed packages, if specified in patch description.</para></listitem>
	</itemizedlist>
      </para></listitem>
      <listitem><para>Install images (might also be a special case of a script)</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>(Optionally) remove downloaded packages after installation.</para></listitem>
  <listitem><para>Store which patches have been installed.</para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Patch deinstallation</title>
<para>
<itemizedlist>
  <listitem><para>Call Postinstall script with --uninstall option</para></listitem>
  <listitem><para>Deinstall RPMs and remove images</para></listitem>
  <listitem><para>Call Preinstall script with --uninstall option</para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Script execution</title>
<para>
<itemizedlist>
  <listitem><para>pre and post package installation</para></listitem>
  <listitem><para>If user input is required use ycp module to get it.</para></listitem>
  <listitem><para>log files for stdout and stderr</para></listitem>
  <listitem><para>script management?</para></listitem>
  <listitem><para>requirement for scripts: install and uninstall mode</para></listitem>
</itemizedlist>
</para>
</section>

<section><title>Workflows</title>
<para>
<itemizedlist>
  <listitem><para>Yast Online Update (start with source selection).</para></listitem>
  <listitem><para>Yast Patch CD (start with patch/package selection).</para></listitem>
  <listitem><para>Command line call</para></listitem>
</itemizedlist>
</para>
</section>

</chapter>

<chapter><title>Online Update Implementation</title>

<para>
<itemizedlist>
  <listitem><para>Special you installation source.
    <itemizedlist>
      <listitem><para>Provides set of patches (including dependencies etc.)</para></listitem>
      <listitem><para>uses common file transfer service for downloading patch descriptions.</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Patch selection is done by standard package selection widget
    <itemizedlist>
      <listitem><para>Patches are handled like selections</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Dependency resolving is done by standard solver
    <itemizedlist>
      <listitem><para>Determines order of patches and packages to be installed.</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Installation should be done by standard installation service.
    <itemizedlist>
      <listitem><para>Includes downloading packages, if required (Uses common file transfer service).</para></listitem>
      <listitem><para>Special requirement to execute scripts at certain points of the installation process.</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Common file transfer service
    <itemizedlist>
      <listitem><para>Shared service for downloading files (so that server connections haven't to be established multiple times and authorization is only needed once).</para></listitem>
    </itemizedlist>
  </para></listitem>
  <listitem><para>Patch Database
    <itemizedlist>
      <listitem><para>use same mechanism as for selections?</para></listitem>
    </itemizedlist>
  </para></listitem>
</itemizedlist>
</para>
</chapter>

